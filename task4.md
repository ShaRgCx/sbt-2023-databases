# Prometheus
## 0.Time Series
Для начала разберемся, с какой моделью СУБД мы имеем дело. 

Prometheus использует в себе такое понятие, как Time Series (временной ряд). 
Временной ряд это последовательность наблюдений некоторой величины, упорядоченной во времени. 
С помощью такого подхода можно строить математические модели, анализирующие предыдущие состояния системы для предсказывания ее поведения в будущем.
Примерами временного ряда являются температура на улице в различные моменты времени, котировки на бирже и т.д.
## 1.История развития СУБД
СУБД Prometheus была разработана 24 ноября 2012 года компанией SoundCloud. Prometheus была призвана заменить используемы ранее в компании StatsD и Graphite, 
которые не вполне удовлетворяли нужд компании.

В 2013 году СУБД начала использоваться для мониторинга в компании, а в 2015 было сделано официальное заявление. К 2016 году Прометей использовался в таких компаниях, как
DigitalOcean, Ericsson, CoreOS, Weaveworks, Red Hat и Google.

К текущему моменту Прометей является третьей по популярности СУБД с Time-series и 58 среди всех прочих СУБД (согласно данным с сайта [db-engines](https://db-engines.com/en/ranking))
## 2.Инструменты для взаимодействия с СУБД
Прометей можно развернуть в докере, или на локальной машине, согласно гайду на официальном [сайте](https://prometheus.io/docs/introduction/first_steps/). Кроме того, существуют официальные библиотеки 
для работы через Go, Java, Python, Ruby, Rust. И неофициальные через практически все прочие используемые языки программирования. Информация по библиотекам досутпна [здесь](https://prometheus.io/docs/instrumenting/clientlibs/https://prometheus.io/docs/instrumenting/clientlibs/).

Поддерживается работа, через UI в браузере при подключении к необходимому хосту.

Prometheus часто используется в связке с Grafana, поэтому в данную СУБД включена нативная поддержка данного ПО.
## 3.Какой database engine используется в вашей СУБД?


## 4.Как устроен язык запросов в вашей СУБД? Разверните БД с данными и выполните ряд запросов. 
Скачаем образ с официального [сайта](https://prometheus.io/download/). Распакуем и запустим его. При необходимости, можно настроить конфиг для указания, откуда и какие собирать метрики:

![image](https://user-images.githubusercontent.com/78553805/236792360-b453ad78-ca98-428e-85df-bdb69ec92e47.png)

Подключимся к localhost:9090 и проверим, что Прометей действительно запустился:

![image](https://user-images.githubusercontent.com/78553805/236792497-41f2d57a-8e59-4ea3-832d-c051d965f3b8.png)

Посмотрим на то, какие метрики собирает Прометей по умолчанию:

![image](https://user-images.githubusercontent.com/78553805/236796366-1b1bac4c-f53c-4988-9b20-f6431429d79c.png)

Построим график частоты htpp запросов с кодом 200, которые отправлял Прометей:

![image](https://user-images.githubusercontent.com/78553805/236796786-370129fe-8d8b-4892-977b-420b73075e31.png)

## 5.Возможно ли распределение файлов БД по разным носителям?
Кластеризация не поддерживается. (Поддеерживается в расширении Prometheus Operator, но это другой уровень абстракции)


## 6.На каком языке/ах программирования написана СУБД?
Согласно FAQ с официального [сайта](https://prometheus.io/docs/introduction/faq/#what-language-is-prometheus-written-in), Прометей написан в основном на Go с вставками на Java, Python и Ruby

![image](https://user-images.githubusercontent.com/78553805/236793091-2397c30c-c8fb-4ab6-a1f3-3f01d55a1c34.png)

## 7.Какие типы индексов поддерживаются в БД? Приведите пример создания индексов.
Индексы не поддерживаются в Прометее.

## 8.Как строится процесс выполнения запросов в вашей СУБД?


## 9.Есть ли для вашей СУБД понятие «план запросов»? Если да, объясните, как работает данный этап.


## 10.Поддерживаются ли транзакции в вашей СУБД? Если да, то расскажите о нем. Если нет, то существует ли альтернатива?
Прометей не поддерживает систему транзакций. Альтренатив не существует, но т.к. СУБД используется для мониторнга данных и сбора статистики, странно иметь в ней транзакции, так как ручное изменение данных не подразумевается, а значит, принципы ACID в принципе не применимы к подобной схеме.

## 11.Какие методы восстановления поддерживаются в вашей СУБД. Расскажите о них.
Методы восстановления не поддерживаются, данные не реплицируются на другие ноды и не кластеризуются. Но при этом всегда сохраняется текущий блок данных, защищенный от падений через WAL, поэтому в случае падения сервера, всегда будет доступен последний блок данных при рестарте.

Разработчики рекомендуют делать снапшоты текущих данных для возможности восстановлению ([подробнее](https://prometheus.io/docs/prometheus/latest/querying/api/#snapshot))

## 12.Расскажите про шардинг в вашей конкретной СУБД. Какие типы используются? Принцип работы.


## 13.Возможно ли применить термины Data Mining, Data Warehousing и OLAP в вашей СУБД?
Применим OLAP, СУБД в основном применяется для потокового анализа данных и построения метрик для анализа работы приложений и серверов.

## 14.Какие методы защиты поддерживаются вашей СУБД? Шифрование трафика, модели авторизации и т.п.
Основные методы безопасности, используемые Прометеем указаны на [этой странице](https://prometheus.io/docs/operating/security/).

## 15.Какие сообщества развивают данную СУБД? Кто в проекте имеет права на коммит и создание дистрибутива версий? Расскажите об этих людей и/или компаниях.
Прометей является open-source решением, поэтому участие в разработке может принимать любой пользователь. Основные средства на разработку были выделены компанией SoundCloud. Оснонвые разработкичи это 
[Matt. T Proud](https://www.matttproud.com/index.html) и [Julius Volz](https://juliusv.com/). Кроме того, активное участие в разработке принимают следующие [личности](https://prometheus.io/governance/) и [компании](https://prometheus.devstats.cncf.io/d/5/companies-table?orgId=1).

SoundCloud это популярная площадка для выкладывания и прослушивания музыки. В начале своего пути у компании фактически не было аналогов, что дало ей изначальную популярность. Площадка дала старт большому количеству современных артистов.

Джулиус Волз и Матт Прауд оба работали в гугле и в будушем занимались разработкой на саундклауде. Подробную информацию об этих личностях можно найти на их личных сайтах, ссылки на которые даны выше.
## 16.Создайте свои собственные данные для демонстрации работы СУБД. 
Настроим мониторинг системных параметров (использование RAM, CPU и пр.) для демонстрации возможностей сборки метрик через Прометей.

Скачаем с официального сайта утилиту для мониторинга локальной машины. Настроим конфиг на прослушивание на порте 9100:
![image](https://user-images.githubusercontent.com/78553805/236806795-f91cd025-8f40-497d-b677-b85d2c238d70.png)

Перезапустим Прометей с примененным конфигом. Можем посмотреть на использование сети с помощью Прометея:

![image](https://user-images.githubusercontent.com/78553805/236807236-9956bb81-e2b9-4fa2-beab-b0e55d1dfdfb.png)
 
 Или на исполльзование CPU:
 
 ![image](https://user-images.githubusercontent.com/78553805/236807433-df180dbc-a249-479a-83e2-1fa7b1ba3440.png)

Скачаем и установим Grafana Agent и построим Dashboard наших метрик в нем:

![image](https://user-images.githubusercontent.com/78553805/236810788-d9709180-2d97-413b-9a59-4d5182229ee6.png)

Подключимся к агенту через личный кабинет на сайте [Grafana](https://grafana.com/). Протестируем подключение:

![image](https://user-images.githubusercontent.com/78553805/236811288-dc9ab828-3256-4067-b31d-11779940cccb.png)

Видим, что все работает. Зайдем в редактор дэшборда. В нем с помощью удобного фильтра можем выбрать необходимую метрику и то, как мы хотим ее считать (фактически конструктор запросов к базе данных):

![image](https://user-images.githubusercontent.com/78553805/236846459-656346da-8fce-4f80-9d3e-ae6b921365a7.png)


Кроме того, запросы можно писать вручную в консоли:

![image](https://user-images.githubusercontent.com/78553805/236844988-3c3ea850-7224-437d-b9c5-241e4d33ebba.png)


Соберем небольшой дэшборд, отслеживающий состояние нашей машины:

![image](https://user-images.githubusercontent.com/78553805/236847569-9e1c8ae6-fcfb-4079-8c8c-333cccd139ae.png)


## 17.Как продолжить самостоятельное изучение языка запросов с помощью демобазы. Если демобазы нет, то создайте ее.
Демобаза в Прометее отсутствует, выше была показана настройка на сбор данных с локальной машины.
## 18.Где найти документацию и пройти обучение
Документация доступна на официальном [сайте](https://prometheus.io/docs/introduction/overview/). 

Ссылки на ресуры для обучения также доступны на официальном [сайте](https://prometheus.io/support-training/).

## 19.Как быть в курсе происходящего
[сайт](https://prometheus.io), [github](https://github.com/prometheus/prometheus), [Twitter](https://twitter.com/PrometheusIO)

Кроме того, существуют различные тематические сообщества, посвященные обсуждению данной СУБД. Вся информация есть на [этой](https://prometheus.io/community/) странице.

## Источники
Основная информация была получена с [официального сайта](https://prometheus.io/) и следующих статей:

+ https://habr.com/ru/companies/southbridge/articles/455290/
+ https://habr.com/ru/companies/otus/articles/358588/
+ https://habr.com/ru/companies/ozontech/articles/657933/
+ https://habr.com/ru/companies/selectel/articles/275803/
+ https://habr.com/ru/companies/southbridge/articles/516748/


